import{_ as se}from"./Dp47PizI.js";import{_ as ae}from"./CofHm-fC.js";import{_ as oe}from"./DeUu3Z46.js";import{_ as re}from"./SM7hxz3n.js";import{_ as le}from"./DvjQmpBb.js";import{_ as ie}from"./xBkyOM2N.js";import{_ as ne}from"./CKaSsRbv.js";import{_ as de}from"./BGCo7yP8.js";import{_ as ue}from"./BvXbKU5y.js";import{_ as pe}from"./BeFclaUx.js";import{_ as ce}from"./CfMjetS_.js";import{e as me,r as i,j as fe,C as E,J as ve,i as N,o as S,w as n,b as r,a,d as v,u as t,l as R,n as I,K as _e,f as U,t as V,H as ye,I as ge,c as H,s as q}from"./Bt1u4B0-.js";import{b as ke,c as xe,d as be}from"./cAEg1be4.js";import{u as Se}from"./BMe8QPLZ.js";import{u as Ce}from"./B4oWGeeH.js";import{f as we}from"./DkQxb8LZ.js";import"./C4a3JGsQ.js";import"./B1-n2jGE.js";import"./84gp303H.js";const Ie={class:"flex gap-2"},Le={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},Pe={class:"flex flex-col gap-4"},he={class:"grid grid-cols-2 gap-4"},De={class:"flex flex-col justify-center items-center"},Ae={class:"flex flex-col justify-center items-center"},Ne={class:"flex justify-between items-end"},Oe={class:"text-gray-500 text-xs flex gap-1"},Ke={class:"overflow-auto col-span-2 max-h-[400px]"},Te={class:"overflow-auto max-h-[400px] border-l"},$e={class:"flex justify-between items-center hover:bg-gray-100 rounded-lg p-2"},Be={class:"flex justify-between items-center"},Ue=["src"],Ve={key:1,class:"p-4 text-center text-gray-400"},lt=me({__name:"sku-to-print",setup(Me){const{generateQRCodes:Q,imageUrls:p}=Se();Ce({title:"SKU To Print"});const z=we(new Date,"YYYY-MM-DD"),L=i(z),u=i([]),M=localStorage.getItem("skipList");if(M)try{u.value=JSON.parse(M)}catch(s){console.error("Failed to parse skipList from localStorage:",s),u.value=[]}const F=i([{label:"Skip List",key:"skipList"}]),c=i(""),Y=i([]),P=i(null),C=i(!1),j=i(null),W=i([{key:"sku",label:"SKU",sort:!0},{key:"qty",label:"Total(QTY)",sort:!0},{key:"remains",label:"Remaining to find",sort:!0}]),h=i([]),g=i(""),k=i(!1),O=i({trackingCode:"",orderId:""}),D=i(!1),G=fe(()=>Array.isArray(u.value)?u.value.map(s=>s.skipList):[]),_=i(""),X=async()=>{if(g.value){p.value[0]="";try{const s=l.value?ke:xe,e={sku:g.value,date:L.value,...l.value?{}:{skippedOrders:G.value,trackingCode:_.value}},{data:o,error:m}=await s(e);if(m!=null&&m.message){D.value=!0,K("Warning !",m.message);return}if(o.info){const x=l.value?o.info:o.info[0],{sku:b,qty:f,trackingCode:y,updatedAt:T,orderItemId:A,orderId:$}=x;Y.value=l.value?[A]:o.info.flatMap(B=>B.orderItemIds),c.value=l.value?$:o.orderId,_.value=y,k.value=o.isDone||!1,h.value=l.value?[{sku:b,qty:f,remains:f}]:o.info,Q([{trackingId:y,sku:o.info.length>1?"":b,qty:f,updatedDate:T}])}if(!P.value||!p.value.length)return;const w=async x=>{await P.value.handlePrint(p.value[0],async()=>{await be({orderItemIds:Y.value,action:"shipped out of HK"}),(!l.value||x)&&(c.value="",_.value="")},b=>{K("Error !",b)},"small")};(l.value||k.value)&&await w(k.value)}catch(s){K("Error !",s)}finally{g.value=""}}},K=(s,e)=>{q({title:s,content:e},s==="Warning !"?"warning":"danger")},Z=()=>{if(!c.value)return;u.value.push({skipList:c.value});const s=Array.from(new Set(u.value.map(e=>JSON.stringify(e)))).map(e=>JSON.parse(e));u.value=s,localStorage.setItem("skipList",JSON.stringify(u.value)),c.value="",_.value="",h.value=[]},ee=s=>{const e=localStorage.getItem("skipList");if(e)try{const o=JSON.parse(e);if(!Array.isArray(o))return;const m=o.filter(w=>w.skipList!==s);localStorage.setItem("skipList",JSON.stringify(m)),u.value=m}catch{q({title:"Error !",content:"Invalid skipList data format."},"danger")}},te=s=>{C.value=s},l=i(!0),J=s=>{l.value=s};return E(()=>l.value,()=>{p.value[0]="",h.value=[],c.value="",_.value="",O.value={trackingCode:"",orderId:""},k.value=!1}),E(()=>C.value,async s=>{var e,o;s&&(await ve(),(o=(e=j.value)==null?void 0:e.inputElement)==null||o.focus())}),(s,e)=>{const o=se,m=ae,w=oe,x=re,b=le,f=ie,y=ne,T=de,A=ue,$=pe,B=ce;return S(),N(B,null,{default:n(()=>[r(m,{title:"SKU Not Found","backdrop-close":!1,visible:t(D),onClose:e[1]||(e[1]=d=>D.value=!1)},{footer:n(()=>[a("div",Ie,[r(o,{color:"primary",onClick:e[0]||(e[0]=d=>D.value=!1)},{default:n(()=>e[7]||(e[7]=[v(" OK ")])),_:1})])]),default:n(()=>[e[8]||(e[8]=v(" This SKU is not in the list, please scan again. "))]),_:1},8,["visible"]),r(w,{ref_key:"refPrinter",ref:P,onSetupCompleted:te},null,512),a("div",Le,[r(y,{class:I([!t(C)&&"disabled-card"])},{header:n(()=>[r(x,null,{default:n(()=>e[9]||(e[9]=[a("div",{class:"flex justify-start items-center h-[38px]"},[a("div",null,"Basic Settings")],-1)])),_:1})]),default:n(()=>[a("div",Pe,[r(b,{label:"Date",modelValue:t(L),"onUpdate:modelValue":e[2]||(e[2]=d=>R(L)?L.value=d:null),range:!1,"value-type":"YYYY-MM-DD",class:"md:m-0 mb-2 min-w-[49%]"},null,8,["modelValue"]),e[15]||(e[15]=v(" Type ")),a("div",he,[r(y,{class:I([t(l)?"bg-primary4! border-primary2 text-primary-dark":"bg-gray-100! border-gray-300 text-gray-500"]),onClick:e[3]||(e[3]=d=>J(!0))},{default:n(()=>[a("div",De,[r(f,{class:"icon-simple text-xl opacity-70"}),e[10]||(e[10]=a("div",null,"Simple Pack",-1)),e[11]||(e[11]=a("div",{class:"opacity-70"},"one to one",-1))])]),_:1},8,["class"]),r(y,{class:I([t(l)?"bg-gray-100! border-gray-300 text-gray-500":"bg-primary4! border-primary2 text-primary-dark"]),onClick:e[4]||(e[4]=d=>J(!1))},{default:n(()=>[a("div",Ae,[r(f,{class:"icon-complex text-xl opacity-70"}),e[12]||(e[12]=a("div",null,"Complex Pack",-1)),e[13]||(e[13]=a("div",{class:"opacity-70"},"multiple Items",-1))])]),_:1},8,["class"])]),r(T,{ref_key:"inputRef",ref:j,modelValue:t(g),"onUpdate:modelValue":e[5]||(e[5]=d=>R(g)?g.value=d:null),modelModifiers:{trim:!0},placeholder:"Please scan the SKU",disabled:!t(C),label:"SKU",onKeydown:_e(X,["enter"])},null,8,["modelValue","disabled"]),a("div",Ne,[a("div",Oe,[t(_)?(S(),N(f,{key:0,class:"icon-box"})):U("",!0),v(" "+V(t(_)||t(O).trackingCode)+" ",1),t(c)?(S(),N(f,{key:1,class:"icon-page"})):U("",!0),v(" "+V(t(c)||t(O).orderId),1)]),t(l)?U("",!0):(S(),N(o,{key:0,color:"secondary",size:"xs",onClick:Z,disabled:!t(c)},{default:n(()=>e[14]||(e[14]=[v(" Skip ")])),_:1},8,["disabled"]))]),a("div",{class:I(["border rounded-lg overflow-auto",{"grid grid-cols-3":!t(l)}])},[a("div",Ke,[r(A,{items:t(h),headers:t(W)},null,8,["items","headers"])]),ye(a("div",Te,[r(A,{items:t(u),headers:t(F),hover:!1},{skipList:n(({item:d})=>[a("div",$e,[v(V(d.skipList)+" ",1),r(f,{class:"icon-hide cursor-pointer",onClick:Ye=>ee(d.skipList)},null,8,["onClick"])])]),_:1},8,["items","headers"])],512),[[ge,!t(l)]])],2)])]),_:1},8,["class"]),r(y,null,{header:n(()=>[r(x,null,{default:n(()=>[a("div",Be,[e[17]||(e[17]=a("div",null,"Preview",-1)),r(o,{color:"primary",disabled:!t(C)||!t(p)[0],onClick:e[6]||(e[6]=d=>t(P).handlePrint(t(p)[0],void 0,void 0,"small"))},{default:n(()=>e[16]||(e[16]=[v(" Print Label ")])),_:1},8,["disabled"])])]),_:1})]),default:n(()=>[r($,{color:"primary",visible:!t(l)&&t(p)[0]!=""&&!t(k)},{default:n(()=>e[18]||(e[18]=[v(" All remaining items must be identified before the shipping label can be printed. ")])),_:1},8,["visible"]),t(p)[0]?(S(),H("img",{key:0,src:t(p)[0],alt:"",class:I([!t(k)&&!t(l)?"opacity-50":"opacity-100"])},null,10,Ue)):(S(),H("div",Ve,"No Data"))]),_:1})])]),_:1})}}});export{lt as default};
